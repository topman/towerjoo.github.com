<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="author" content="towerjoo" />
<meta name="keywords" content="GSoC" />
<title> Dig into code base and Refine the trac feeds / 找寻模式</title>
<link href="http://towerjoo.github.com/feed.xml" rel="alternate" title="找寻模式" type="application/atom+xml" />

<link rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/assets/css/pygment_trac.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print" />
</head>

<body>



<div class="container">
<section id="main_content">

<header>
	<h1><a href="/" class="minor">找寻模式</a> / Dig into code base and Refine the trac feeds
        </h1>
	<p class="additional">阅读, 人生, 技术</p>
    <div id="header_nav">
    <a href="/category.html">Category</a>
    <a href="/archive.html">Archive</a>
    <a href="/projects.html">Projects</a>
    <a href="/links.html">Links</a>
    <a href="/about.html">About</a>
    </div>
    <div id="search_box">
    <form action="/search/" class="block block-search">
    <input type="search" name="q" placeholder="回车搜索" />
    </form>
    </div>
</header>


<article>
	<h1><a href="/blog/2010/05/31/dig-into-code-base-and-refine-the-trac-feeds">Dig into code base and Refine the trac feeds</a></h1>
	
	<p class="meta">
	<span class="datetime">2010-05-31</span> posted in [<a href="/category/tech" class="category">技术模式</a>] with tags: [GSoC]
</p>

	<p>The passed week was very busy to me, since the graduation reply. I&rsquo;m happy that I am about to graduate from the 19 years schooling career, which is really long.  A new start to me, and a new start since then.
    
Following the last week&rsquo;s plan, I went on the refinement of Trac feeds plugin and have made the following tuning:</p>

<p>1.fault tolerance </p>

<p>The main work went to the fault tolerance, and the UI refinement was rejected at last since it&rsquo;s hard to make a balance between good UI and complex implementation.</p>

<p>And besides that, I started to read the source code of touch screen. Since it&rsquo;s based on Django, I follow the approach of the common Django apps, i.e. urls -&gt; views -&gt; models-&gt;templates.</p>

<p>Let&rsquo;s begin the journey. </p>

<h2 id="coreurlspy">core/urls.py</h2>

<p>After digging into the urls.py, it&rsquo;s easy to know each installed plugins will be shown in loalhost/ or localhost/display/, which dispatches the request to display function at core/views.py.</p>

<h2 id="coreviewspy">core/views.py</h2>

<p>To simplify the analysis, I will omit some files and logics.</p>

<p>Let&rsquo;s focus on the display function, which render the django dict variables to the corresponding template display.html. The rendered dict includes:</p>

<ul>
  <li>&lsquo;screens&rsquo;:PLUGIN_MANAGER[&lsquo;ScreenManager&rsquo;].plugins</li>
  <li> rc = RequestContext(request, processors=[plugin_processor, settings_processor])</li>
  <li>&lsquo;screen_animations&rsquo;:PLUGIN_MANAGER[&lsquo;ScreenAnimationManager&rsquo;].plugins</li>
</ul>

<p>RequestContext will make the plugin_manager and each plugin&rsquo;s setting available to the template.
and also the screens(plugins) and corresponding animation will be available.</p>

<p>Then let&rsquo;s go to the template.</p>

<h2 id="coredisplayhtml">core/display.html</h2>

<p>In this file, it will load the needed javascript/css to make the infrastructure. </p>

<script src="https://gist.github.com/3150152.js?file=gistfile1.py"></script>

<p>And the above code snippet will include each screen&rsquo;s specific html into the main html.</p>

<h2 id="screens-specific-html">Screen&rsquo;s specific html</h2>

<p>Each screen&rsquo;s specific html will decide what content will be put in the screen(plugin) and how it can be shown and also you can write the control commands(key events and etc.) to ease the navigate.</p>

<p>This portion should obey the conversion which is defined by the  touch screen.</p>

<h2 id="summary">Summary</h2>

<p>Till now I only get a big picture of the architecture of touch screen, and some details are still in front me which needs to catch, including:</p>

<ul>
  <li>other control approaches(twisted and so on)</li>
  <li>the complex class hierarchy </li>
  <li>the plugin system</li>
  <li>the menu system</li>
  <li>thread syncing mechanism</li>
</ul>

<p>And after reading some codes, I found some not-so-good codes, e.g. the main html(display.html), in which lots of jquery plugins are included in and most of them are not used in most of the plugins. And also when I try to read the codes of some screen examples, and I found some jquery plugin codes, and I try to figure out which plugin this function belongs to but finally I found it&rsquo;s really difficult to locate the function. IMO, we can refactor the main html and remove the not-necessary  jquery codes and include them in the specific plugin template if the screen html really needs it.</p>

<h2 id="plan">plan</h2>

<p>I will finish my graduation reply this Thursday and will have plenty of time to work on GSoC.</p>

<p>My plan will base on my proposal and also will make some adjustment from mentor&rsquo;s advices.</p>

<p>For the new week, I will:</p>

<ul>
  <li>read codes</li>
  <li>understand the plugin system</li>
  <li>understand the menu system</li>
  <li>understand the twisted interface</li>
  <li>do some preparation for this ticket http://trac.osuosl.org/trac/touchscreen/ticket/12</li>
</ul>


	
	<!--<p class="permalink">永久链接：<a href="http://towerjoo.github.com/blog/2010/05/31/dig-into-code-base-and-refine-the-trac-feeds">http://towerjoo.github.com/blog/2010/05/31/dig-into-code-base-and-refine-the-trac-feeds</a></p>-->
</article>
<div id="disqus_thread" class="comments"></div>
<!-- JiaThis Button BEGIN -->
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jiathis_r.js?move=0&amp;btn=r2.gif&amp;uid=89469" charset="utf-8"></script>
<!-- JiaThis Button END -->

<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'towerjoo'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</section>
</div>

<footer>
		<p>&copy; Since 2012 <a href="http://github.com/towerjoo" target="_blank">github.com/towerjoo</a></p>
</footer>

<div id="side_top">
    <a href="#">Top</a>
</div>

</body>
</html>
